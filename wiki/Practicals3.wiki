= Practical 3: Linking VMS and logbook data and explore the benefits =

== Introduction ==
You have already come a long way by importing your VMS and logbook data, cleaning your datasets to ensure that whatever analyses you want to carry out, the basis is solid. We can't stress it enough, as with normal statistics, getting your data ready and in the right format is crucial for your results. 

The potential of having these two datasets combined is large and discussed in the presentation already. Here we will show how it's done and how to make some first pictures out of it. You might be disappointed however when you see how much work it takes :-).

== Getting the data ready ==
If you still have an R version running with the results of the cleaning step, use those eflalo and tacsat results. If you had to start R anew, don't worry, we will show you how it works, and with your own data you can do it properly in one go (but note that you should only start to link VMS and logbook data after the cleaning process!).

== Linking VMS and logbook data ==
<code>
>tacsatp <- mergeEflalo2Tacsat(eflalo,tacsat)
>head(tacsatp)
         VE_COU VE_REF  SI_LATI  SI_LONG    SI_DATE  SI_TIME SI_SP SI_HE            SI_DATIM INTV FT_REF
662894 Atlantis     10 51.67319 3.176576 05/05/1800  4:54:00     2    43 1800-05-05 04:54:00  116 272058
662895 Atlantis     10 51.69432 3.229084 05/05/1800  6:48:00     2   294 1800-05-05 06:48:00  114 272058
662896 Atlantis     10 51.65607 3.160989 05/05/1800  8:44:00     6   144 1800-05-05 08:44:00  116 272058
662897 Atlantis     10 51.60704 3.083506 05/05/1800 10:40:00     7   248 1800-05-05 10:40:00  116 272058
662898 Atlantis     10 51.57692 2.987796 05/05/1800 14:30:00     6   228 1800-05-05 14:30:00  230 272058
662899 Atlantis     10 51.54655 2.876395 05/05/1800 16:24:00     7    50 1800-05-05 16:24:00  114 272058

>print(length(which(tacsatp$FT_REF == 0))) #number of records not able to link
</code>
What we can observe is that another column is added to the 'tacsatp' object, namely the 'FT_REF' column. What happened 'under the hood' is the linking of VMS and logbook based on vessel name+year and time stamps, such that each VMS record would fall within the time frame of departure and arrival of a logbook record of that same vessel. Now we know which VMS record can be associated with which eflalo record. This allows for some cool things to explore. Note that if no linking was possible, FT_REF will equal "0".
<code>
#Move the gear type from eflalo to tacsat
>tacsatp$LE_GEAR <- eflalo$LE_GEAR[match(tacsatp$FT_REF,eflalo$FT_REF)]

#Let's see if it worked correctly
>subset(tacsatp,FT_REF == "326494")
         VE_COU VE_REF  SI_LATI  SI_LONG    SI_DATE  SI_TIME SI_SP SI_HE            SI_DATIM INTV FT_REF LE_GEAR
1019702 Atlantis    102 51.63328 3.480378 20/12/1801  7:16:00   0.6   354 1801-12-20 07:16:00  114 326494     DRB
1019703 Atlantis    102 51.64547 3.462132 20/12/1801  9:12:00   0.0   258 1801-12-20 09:12:00  116 326494     DRB
1019704 Atlantis    102 51.63715 3.447098 20/12/1801 11:06:00   0.0   280 1801-12-20 11:06:00  114 326494     DRB
1019705 Atlantis    102 51.63734 3.451090 20/12/1801 13:02:00   0.2    86 1801-12-20 13:02:00  116 326494     DRB
1019706 Atlantis    102 51.63760 3.458493 20/12/1801 14:58:00   0.6   132 1801-12-20 14:58:00  116 326494     DRB
1019707 Atlantis    102 51.64877 3.528120 20/12/1801 16:52:00   6.8    72 1801-12-20 16:52:00  114 326494     DRB

>subset(eflalo,FT_REF == "326494")
      VE_REF VE_FLT   VE_COU VE_LEN VE_KW VE_TON FT_REF FT_DCOU FT_DHAR    FT_DDAT FT_DTIME FT_LCOU FT_LHAR    FT_LDAT FT_LTIME
48267    102    DRB Atlantis     29   127     NA 326494     nld      NL 20/12/1801 06:00:00     nld      NL 20/12/1801 18:00:00
</code>

=== Exercise 1 ===
  # Check if in the example above the merging went well. How do you check?
  # What types of gears are available in the VMS dataset, how many of each?

== Explore the benefits ==
Similar to the presentation, we will quickly look into four types of benefit
  # Distinguish fishery types
  # Define activity
  # Fine scale effort patterns
  # Distribution of catches / values

=== Distinguish fishery types ===
Most often, fishery type is determined by the gear used when fishing. As we have already assigned gear type from eflalo to tacsat, splitting the tacsat data up into bits per gear type is not too difficult.
<code>
>TBB <- subset(tacsatp,LE_GEAR == "TBB")
>OTB <- subset(tacsatp,LE_GEAR == "OTB")

#Let's see what speed profiles are associated with these fishery types
>par(mfrow=c(2,1))
>hist(TBB$SI_SP,breaks=100,xlim=c(0,20),xlab="Knots",main="OTB")
>hist(OTB$SI_SP,breaks=100,xlim=c(0,20),xlab="Knots",main="OTB")
</code>
Do not close this picture immediately, it comes in handy in the next example. 

=== Define activity ===
In many cases, activity can be defined based on speed. We've just made a picture of the speed profiles. Can you distinguish different behavior looking at these plots already?
